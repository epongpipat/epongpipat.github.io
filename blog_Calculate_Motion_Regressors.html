<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />



<meta name="date" content="2018-03-20" />

<title>Calculate Motion Regressors</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/lumen.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.0.13/css/fa-svg-with-js.css" rel="stylesheet" />
<script src="site_libs/font-awesome-5.0.13/js/fontawesome-all.min.js"></script>
<script src="site_libs/font-awesome-5.0.13/js/fa-v4-shims.min.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-116039246-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-116039246-1');
</script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 54px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 59px;
  margin-top: -59px;
}

.section h2 {
  padding-top: 59px;
  margin-top: -59px;
}
.section h3 {
  padding-top: 59px;
  margin-top: -59px;
}
.section h4 {
  padding-top: 59px;
  margin-top: -59px;
}
.section h5 {
  padding-top: 59px;
  margin-top: -59px;
}
.section h6 {
  padding-top: 59px;
  margin-top: -59px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">



<nav class="navbar navbar-default navbar-fixed-top">
  <div class="container">

    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"><span class="fas fa-terminal" aria-hidden="true"></span></a>
      <a class="navbar-brand" href="index.html"><img src="images/icons8-artificial-intelligence-100.png" style="height: 20px"></a>
      <a class="navbar-brand" href="index.html"><img src="images/icons8-scatter-plot-96.png" style="height: 20px"></a>
      <a class="navbar-brand" href="index.html">Ekarin Eric Pongpipat, M.A.</a>
    </div> <!-- /.navbar-header -->

    <div class="collapse navbar-collapse" id="navbar-collapse">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="index.html"><span class="fas fa-quote-left" aria-hidden="true"></span> &ensp;Blog</a></li>
        <li><a href="CV.html"><span class="far fa-id-badge" aria-hidden="true"></span> &ensp;CV</a></li>
        <li><a href="https://github.com/epongpipat" target="_blank"><span class="fa fa-github" aria-hidden="true"></span> &ensp;GitHub</a></li>

        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><span class="fas fa-link" aria-hidden="true"></span> &ensp;Connect<span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="mailto:epongpipat@gmail.com" target="_blank"><span class="fa fa-envelope" aria-hidden="true"></span> &ensp;Email</a></li>
            <li role="separator" class="divider"></li>
            <li><a href="https://www.researchgate.net/profile/Ekarin_Pongpipat" target="_blank"><span class="fab fa-researchgate" aria-hidden="true"></span> &ensp;ResearchGate</a></li>
            <li><a href="https://www.linkedin.com/in/epongpipat/" target="_blank"><span class="fa fa-linkedin" aria-hidden="true"></span> &ensp;LinkedIn</a></li>
          </ul>
        </li>

      </ul>
    </div> <!-- /.navbar-collapse -->

  </div> <!-- /.container -->
</nav> <!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Calculate Motion Regressors</h1>
<h3 class="subtitle"><em>A quick guide to calculating motion regressors (with visuals)</em></h3>
<h4 class="date"><em>2018-03-20</em></h4>

</div>


<p><em>Tags:</em> <span class="badge badge-pill badge-dark">fMRI</span> <span class="badge badge-pill badge-primary">R</span></p>
<p><BR></p>
<p>These motion covariates can be used as potential control variables for resting-state and task-based functional connectivity.</p>
<p><BR><BR></p>
<div id="rigid-body-motion-regressors" class="section level2">
<h2>6-Rigid Body Motion Regressors</h2>
<p>The first six motion parameters are the standard outputted motion parameters and include:</p>
<ol style="list-style-type: decimal">
<li><span class="math inline">\(X\)</span>, translation in the x-direction</li>
<li><span class="math inline">\(Y\)</span>, translation in the y-direction</li>
<li><span class="math inline">\(Z\)</span>, translation in the z-direction</li>
<li><span class="math inline">\(Roll\)</span>, rotation around the x-axis</li>
<li><span class="math inline">\(Pitch\)</span>, rotation around the y-axis</li>
<li><span class="math inline">\(Yaw\)</span>, rotation around the z-axis</li>
</ol>
<pre class="r"><code># load 6-rigidy body motion parameters
motion_demeaned &lt;- read.csv(&quot;blog_Calculate_Motion_Regressors_files/example_motion_demeand.csv&quot;,header = FALSE)

# motion_demeaned &lt;- t(apply(motion_demeaned, 1, sample, replace=TRUE))
# 
# motion_demeaned &lt;- as.data.frame(motion_demeaned)

# rename columns
colnames(motion_demeaned) &lt;- c(&quot;x&quot;,&quot;y&quot;,&quot;z&quot;,&quot;roll&quot;,&quot;pitch&quot;,&quot;yaw&quot;)

# add duration for graphs
motion_demeaned$duration &lt;- c(1:780)

# plot x
motion_x &lt;- ggplot(motion_demeaned, mapping = aes(x = duration, y = x)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle(&quot;X&quot;) +
  xlab(&quot;Duration&quot;) + 
  ylab(&quot;mm&quot;)

# plot y
motion_y &lt;- ggplot(motion_demeaned, mapping = aes(x = duration, y = y)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle(&quot;Y&quot;) +
  xlab(&quot;Duration&quot;) + 
  ylab(&quot;mm&quot;)

# plot z
motion_z &lt;- ggplot(motion_demeaned, mapping = aes(x = duration, y = z)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle(&quot;Z&quot;) +
  xlab(&quot;Duration&quot;) + 
  ylab(&quot;mm&quot;)

# plot roll
motion_roll &lt;- ggplot(motion_demeaned, mapping = aes(x = duration, y = roll)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle(&quot;Roll&quot;) +
  xlab(&quot;Duration&quot;) + 
  ylab(&quot;Degrees&quot;)

# plot pitch
motion_pitch &lt;- ggplot(motion_demeaned, mapping = aes(x = duration, y = pitch)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle(&quot;Pitch&quot;) +
  xlab(&quot;Duration&quot;) + 
  ylab(&quot;Degrees&quot;)

# plot yaw
motion_yaw &lt;- ggplot(motion_demeaned, mapping = aes(x = duration, y = yaw)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle(&quot;Yaw&quot;) +
  xlab(&quot;Duration&quot;) + 
  ylab(&quot;Degrees&quot;)

# plot 6-rigid body motion parameters into one figure
grid.arrange(motion_x, motion_y, motion_z, motion_roll, motion_pitch, motion_yaw, nrow = 2, ncol = 3, top = &quot;6-Rigid Body Motion Parameters&quot;)</code></pre>
<p><img src="blog_Calculate_Motion_Regressors_files/figure-html/m6-1.png" width="672" /></p>
<p><BR><BR></p>
</div>
<div id="motion-regressors" class="section level2">
<h2>12-Motion Regressors</h2>
<p>The next six motion parameters are the original six rigid body motion parameters squared:</p>
<ol start="7" style="list-style-type: decimal">
<li><span class="math inline">\(X^2\)</span>, translation in the x-direction squared</li>
<li><span class="math inline">\(Y^2\)</span>, translation in the y-direction squared</li>
<li><span class="math inline">\(Z^2\)</span>, translation in the z-direction squared</li>
<li><span class="math inline">\(Roll^2\)</span>, rotation around the x-axis squared</li>
<li><span class="math inline">\(Pitch^2\)</span>, rotation around the y-axis squared</li>
<li><span class="math inline">\(Yaw^2\)</span>, rotation around the z-axis squared</li>
</ol>
<pre class="r"><code># square 6-rigid body motion parameters
motion_demeaned.sq &lt;- motion_demeaned^2 

# save as data frame
motion_demeaned.sq &lt;- as.data.frame(motion_demeaned.sq)

# rename columns
colnames(motion_demeaned.sq) &lt;- c(&quot;x.sq&quot;,&quot;y.sq&quot;,&quot;z.sq&quot;,&quot;roll.sq&quot;,&quot;pitch.sq&quot;,&quot;yaw.sq&quot;,&quot;duration&quot;)

# add duration for graphs
motion_demeaned.sq$duration &lt;- c(1:780)

# plot x.sq
motion_x.sq &lt;- ggplot(motion_demeaned.sq, mapping = aes(x = duration, y = x.sq)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle(&quot;X&quot;) +
  xlab(&quot;Duration&quot;) + 
  ylab(&quot;mm&quot;)

# plot y.sq
motion_y.sq &lt;- ggplot(motion_demeaned.sq, mapping = aes(x = duration, y = y.sq)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle(&quot;Y&quot;) +
  xlab(&quot;Duration&quot;) + 
  ylab(&quot;mm&quot;)

# plot z.sq
motion_z.sq &lt;- ggplot(motion_demeaned.sq, mapping = aes(x = duration, y = z.sq)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle(&quot;Z&quot;) +
  xlab(&quot;Duration&quot;) + 
  ylab(&quot;mm&quot;)

# plot roll.sq
motion_roll.sq &lt;- ggplot(motion_demeaned.sq, mapping = aes(x = duration, y = roll.sq)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle(&quot;Roll&quot;) +
  xlab(&quot;Duration&quot;) + 
  ylab(&quot;Degrees&quot;)

# plot pitch.sq
motion_pitch.sq &lt;- ggplot(motion_demeaned.sq, mapping = aes(x = duration, y = pitch.sq)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle(&quot;Pitch&quot;) +
  xlab(&quot;Duration&quot;) + 
  ylab(&quot;Degrees&quot;)

# plot yaw.sq
motion_yaw.sq &lt;- ggplot(motion_demeaned.sq, mapping = aes(x = duration, y = yaw.sq)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle(&quot;Yaw&quot;) +
  xlab(&quot;Duration&quot;) + 
  ylab(&quot;Degrees&quot;)

# plot motion.sq into one figure
grid.arrange(motion_x.sq, motion_y.sq, motion_z.sq, motion_roll.sq, motion_pitch.sq, motion_yaw.sq, nrow = 2, ncol = 3, top = &quot;6-Rigid Body Motion Parameters Squared&quot;)</code></pre>
<p><img src="blog_Calculate_Motion_Regressors_files/figure-html/m12-1.png" width="672" /></p>
<p><BR><BR></p>
</div>
<div id="motion-regressors-1" class="section level2">
<h2>18-Motion Regressors</h2>
<p>The next six motion parameters are the first temporal derivates of the original six rigid body motion parameters. Specifically, it is the motion minus the motion from the previous time point.</p>
<ol start="13" style="list-style-type: decimal">
<li><span class="math inline">\(X_{TD}\)</span>, first temporal derivative of the translation in the x-direction</li>
<li><span class="math inline">\(Y_{TD}\)</span>, first temporal derivative of the translation in the y-direction</li>
<li><span class="math inline">\(Z_{TD}\)</span>, first temporal derivative of the translation in the z-direction</li>
<li><span class="math inline">\(Roll_{TD}\)</span> first temporal derivative of rotation around the x-axis</li>
<li><span class="math inline">\(Pitch_{TD}\)</span>, first temporal derivative of rotation around the y-axis</li>
<li><span class="math inline">\(Yaw_{TD}\)</span>, first temporal derivative of rotation around the z-axis</li>
</ol>
<pre class="r"><code># calculate first temporal derivative
motion_demeaned.td1 &lt;- sapply(motion_demeaned, FUN=function(x) c(NA,diff(x))) 

# save as dataframe
motion_demeaned.td1 &lt;- as.data.frame(motion_demeaned.td1)

# rename columns
colnames(motion_demeaned.td1) &lt;- c(&quot;x.td1&quot;,&quot;y.td1&quot;,&quot;z.td1&quot;,&quot;roll.td1&quot;,&quot;pitch.td1&quot;,&quot;yaw.td1&quot;,&quot;duration&quot;) 

# add duration for graphs
motion_demeaned.td1$duration &lt;- c(1:780)

# plot x.td1
motion_x.td1 &lt;- ggplot(motion_demeaned.td1, mapping = aes(x = duration, y = x.td1)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle(&quot;X&quot;) +
  xlab(&quot;Duration&quot;) + 
  ylab(&quot;mm&quot;)

# plot y.td1
motion_y.td1 &lt;- ggplot(motion_demeaned.td1, mapping = aes(x = duration, y = y.td1)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle(&quot;Y&quot;) +
  xlab(&quot;Duration&quot;) + 
  ylab(&quot;mm&quot;)

# plot z.td1
motion_z.td1 &lt;- ggplot(motion_demeaned.td1, mapping = aes(x = duration, y = z.td1)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle(&quot;Z&quot;) +
  xlab(&quot;Duration&quot;) + 
  ylab(&quot;mm&quot;)

# plot roll.td1
motion_roll.td1 &lt;- ggplot(motion_demeaned.td1, mapping = aes(x = duration, y = roll.td1)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle(&quot;Roll&quot;) +
  xlab(&quot;Duration&quot;) + 
  ylab(&quot;Degrees&quot;)

# plot pitch.td1
motion_pitch.td1 &lt;- ggplot(motion_demeaned.td1, mapping = aes(x = duration, y = pitch.td1)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle(&quot;Pitch&quot;) +
  xlab(&quot;Duration&quot;) + 
  ylab(&quot;Degrees&quot;)

# plot yaw.td1
motion_yaw.td1 &lt;- ggplot(motion_demeaned.td1, mapping = aes(x = duration, y = yaw.td1)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle(&quot;Yaw&quot;) +
  xlab(&quot;Duration&quot;) + 
  ylab(&quot;Degrees&quot;)

# plot motion.td1 into one figure
grid.arrange(motion_x.td1, motion_y.td1, motion_z.td1, motion_roll.td1, motion_pitch.td1, motion_yaw.td1, nrow = 2, ncol = 3, top = &quot;First Temporal Derivatives of the 6-Rigid Body Motion Parameters&quot;)</code></pre>
<p><img src="blog_Calculate_Motion_Regressors_files/figure-html/m18-1.png" width="672" /></p>
<p><BR><BR></p>
</div>
<div id="motion-regressors-2" class="section level2">
<h2>24-Motion Regressors</h2>
<p>The next six motion parameters are the first temporal derivatives squared.</p>
<ol start="19" style="list-style-type: decimal">
<li><span class="math inline">\(X_{TD}^2\)</span>, first temporal derivative of the translation in the x-direction squared</li>
<li><span class="math inline">\(Y_{TD}^2\)</span>, first temporal derivative of the translation in the y-direction squared</li>
<li><span class="math inline">\(Z_{TD}^2\)</span>, first temporal derivative of the translation in the z-direction squared</li>
<li><span class="math inline">\(Roll_{TD}^2\)</span>, first temporal derivative of rotation around the x-axis squared</li>
<li><span class="math inline">\(Pitch_{TD}^2\)</span> first temporal derivative of rotation around the y-axis squared</li>
<li><span class="math inline">\(Yaw_{TD}^2\)</span>, first temporal derivative of rotation around the z-axis squared</li>
</ol>
<pre class="r"><code># square the first temporal derivative
motion_demeaned.td1.sq &lt;- motion_demeaned.td1^2 # first temporal derivative squared

# save as dataframe
motion_demeaned.td1.sq &lt;- as.data.frame(motion_demeaned.td1.sq)

# rename columns
colnames(motion_demeaned.td1.sq) &lt;- c(&quot;x.td1.sq&quot;,&quot;y.td1.sq&quot;,&quot;z.td1.sq&quot;,&quot;roll.td1.sq&quot;,&quot;pitch.td1.sq&quot;,&quot;yaw.td1.sq&quot;,&quot;duration&quot;) # rename columns

# add duration for graphs
motion_demeaned.td1.sq$duration &lt;- c(1:780)

# plot x.td1.sq
motion_x.td1.sq &lt;- ggplot(motion_demeaned.td1.sq, mapping = aes(x = duration, y = x.td1.sq)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle(&quot;X&quot;) +
  xlab(&quot;Duration&quot;) + 
  ylab(&quot;mm&quot;)

# plot y.td1.sq
motion_y.td1.sq &lt;- ggplot(motion_demeaned.td1.sq, mapping = aes(x = duration, y = y.td1.sq)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle(&quot;Y&quot;) +
  xlab(&quot;Duration&quot;) + 
  ylab(&quot;mm&quot;)

# plot z.td1.sq
motion_z.td1.sq &lt;- ggplot(motion_demeaned.td1.sq, mapping = aes(x = duration, y = z.td1.sq)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle(&quot;Z&quot;) +
  xlab(&quot;Duration&quot;) + 
  ylab(&quot;mm&quot;)

# plot roll.td1.sq
motion_roll.td1.sq &lt;- ggplot(motion_demeaned.td1.sq, mapping = aes(x = duration, y = roll.td1.sq)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle(&quot;Roll&quot;) +
  xlab(&quot;Duration&quot;) + 
  ylab(&quot;Degrees&quot;)

# plot pitch.td1.sq
motion_pitch.td1.sq &lt;- ggplot(motion_demeaned.td1.sq, mapping = aes(x = duration, y = pitch.td1.sq)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle(&quot;Pitch&quot;) +
  xlab(&quot;Duration&quot;) + 
  ylab(&quot;Degrees&quot;)

# plot yaw.td1.sq
motion_yaw.td1.sq &lt;- ggplot(motion_demeaned.td1.sq, mapping = aes(x = duration, y = yaw.td1.sq)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle(&quot;Yaw&quot;) +
  xlab(&quot;Duration&quot;) + 
  ylab(&quot;Degrees&quot;)

# plot motion.td1.sq into one figure
grid.arrange(motion_x.td1.sq, motion_y.td1.sq, motion_z.td1.sq, motion_roll.td1.sq, motion_pitch.td1.sq, motion_yaw.td1.sq, nrow = 2, ncol = 3, top = &quot;First Temporal Derivatives of the 6-Rigid Body Motion Parameters Squared&quot;)</code></pre>
<p><img src="blog_Calculate_Motion_Regressors_files/figure-html/m24-1.png" width="672" /></p>
<p><BR><BR></p>
</div>
<div id="motion-regressors-3" class="section level2">
<h2>30-Motion Regressors</h2>
<p>The next six motion parameters are the second temporal derivatives of the original six rigid body motion parameters. Specifically, it is the motion minus the motion from the two previous time points.</p>
<ol start="25" style="list-style-type: decimal">
<li><span class="math inline">\(X_{TD2}\)</span>, second temporal derivative of the translation in the x-direction</li>
<li><span class="math inline">\(Y_{TD2}\)</span>, second temporal derivative of the translation in the y-direction</li>
<li><span class="math inline">\(Z_{TD2}\)</span>, second temporal derivative of the translation in the z-direction</li>
<li><span class="math inline">\(Roll_{TD2}\)</span>, second temporal derivative of rotation around the x-axis</li>
<li><span class="math inline">\(Pitch_{TD2}\)</span>, second temporal derivative of rotation around the y-axis</li>
<li><span class="math inline">\(Yaw_{TD2}\)</span>, second temporal derivative of rotation around the z-axis</li>
</ol>
<pre class="r"><code># calculate second temporal derivative
motion_demeaned.td2 &lt;- sapply(motion_demeaned, FUN=function(x) c(NA,NA,diff(x, lag = 2))) 

# save as dataframe
motion_demeaned.td2 &lt;- as.data.frame(motion_demeaned.td2)

# rename columns
colnames(motion_demeaned.td2) &lt;- c(&quot;x.td2&quot;,&quot;y.td2&quot;,&quot;z.td2&quot;,&quot;roll.td2&quot;,&quot;pitch.td2&quot;,&quot;yaw.td2&quot;,&quot;duration&quot;) 

# add duration for graphs
motion_demeaned.td2$duration &lt;- c(1:780)

# plot x.td2
motion_x.td2 &lt;- ggplot(motion_demeaned.td2, mapping = aes(x = duration, y = x.td2)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle(&quot;X&quot;) +
  xlab(&quot;Duration&quot;) + 
  ylab(&quot;mm&quot;)

# plot y.td2
motion_y.td2 &lt;- ggplot(motion_demeaned.td2, mapping = aes(x = duration, y = y.td2)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle(&quot;Y&quot;) +
  xlab(&quot;Duration&quot;) + 
  ylab(&quot;mm&quot;)

# plot z.td2
motion_z.td2 &lt;- ggplot(motion_demeaned.td2, mapping = aes(x = duration, y = z.td2)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle(&quot;Z&quot;) +
  xlab(&quot;Duration&quot;) + 
  ylab(&quot;mm&quot;)

# plot roll.td2
motion_roll.td2 &lt;- ggplot(motion_demeaned.td2, mapping = aes(x = duration, y = roll.td2)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle(&quot;Roll&quot;) +
  xlab(&quot;Duration&quot;) + 
  ylab(&quot;Degrees&quot;)

# plot pitch.td2
motion_pitch.td2 &lt;- ggplot(motion_demeaned.td2, mapping = aes(x = duration, y = pitch.td2)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle(&quot;Pitch&quot;) +
  xlab(&quot;Duration&quot;) + 
  ylab(&quot;Degrees&quot;)

# plot yaw.td2
motion_yaw.td2 &lt;- ggplot(motion_demeaned.td2, mapping = aes(x = duration, y = yaw.td2)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle(&quot;Yaw&quot;) +
  xlab(&quot;Duration&quot;) + 
  ylab(&quot;Degrees&quot;)

# plot motion.td2 into one figure
grid.arrange(motion_x.td2, motion_y.td2, motion_z.td2, motion_roll.td2, motion_pitch.td2, motion_yaw.td2, nrow = 2, ncol = 3, top = &quot;Second Temporal Derivatives of the 6-Rigid Body Motion Parameters&quot;)</code></pre>
<p><img src="blog_Calculate_Motion_Regressors_files/figure-html/m30-1.png" width="672" /></p>
<p><BR><BR></p>
</div>
<div id="motion-regressors-4" class="section level2">
<h2>36-Motion Regressors</h2>
<p>The next six motion parameters are the second temporal derivatives squared.</p>
<ol start="31" style="list-style-type: decimal">
<li><span class="math inline">\(X_{TD2}^2\)</span>, second temporal derivative of the translation in the x-direction squared</li>
<li><span class="math inline">\(Y_{TD2}^2\)</span>, second temporal derivative of the translation in the y-direction squared</li>
<li><span class="math inline">\(Z_{TD2}^2\)</span>, second temporal derivative of the translation in the z-direction squared</li>
<li><span class="math inline">\(Roll_{TD2}^2\)</span>, second temporal derivative of rotation around the x-axis squared</li>
<li><span class="math inline">\(Pitch_{TD2}^2\)</span>, second temporal derivative of rotation around the y-axis squared</li>
<li><span class="math inline">\(Yaw_{TD2}^2\)</span>, second temporal derivative of rotation around the z-axis squared</li>
</ol>
<pre class="r"><code># second temporal derivative squared
motion_demeaned.td2.sq &lt;- motion_demeaned.td2^2 

# save as dataframe
motion_demeaned.td2.sq &lt;- as.data.frame(motion_demeaned.td2.sq)

# rename columns
colnames(motion_demeaned.td2.sq) &lt;- c(&quot;x.td2.sq&quot;,&quot;y.td2.sq&quot;,&quot;z.td2.sq&quot;,&quot;roll.td2.sq&quot;,&quot;pitch.td2.sq&quot;,&quot;yaw.td2.sq&quot;,&quot;duration&quot;) 

# add duration for graphs
motion_demeaned.td2.sq$duration &lt;- c(1:780)

# plot x.td2.sq
motion_x.td2.sq &lt;- ggplot(motion_demeaned.td2.sq, mapping = aes(x = duration, y = x.td2.sq)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle(&quot;X&quot;) +
  xlab(&quot;Duration&quot;) + 
  ylab(&quot;mm&quot;)

# plot y.td2.sq
motion_y.td2.sq &lt;- ggplot(motion_demeaned.td2.sq, mapping = aes(x = duration, y = y.td2.sq)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle(&quot;Y&quot;) +
  xlab(&quot;Duration&quot;) + 
  ylab(&quot;mm&quot;)

# plot z.td2.sq
motion_z.td2.sq &lt;- ggplot(motion_demeaned.td2.sq, mapping = aes(x = duration, y = z.td2.sq)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle(&quot;Z&quot;) +
  xlab(&quot;Duration&quot;) + 
  ylab(&quot;mm&quot;)

# plot roll.td2.sq
motion_roll.td2.sq &lt;- ggplot(motion_demeaned.td2.sq, mapping = aes(x = duration, y = roll.td2.sq)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle(&quot;Roll&quot;) +
  xlab(&quot;Duration&quot;) + 
  ylab(&quot;Degrees&quot;)

# plot pitch.td2.sq
motion_pitch.td2.sq &lt;- ggplot(motion_demeaned.td2.sq, mapping = aes(x = duration, y = pitch.td2.sq)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle(&quot;Pitch&quot;) +
  xlab(&quot;Duration&quot;) + 
  ylab(&quot;Degrees&quot;)

# plot yaw.td2.sq
motion_yaw.td2.sq &lt;- ggplot(motion_demeaned.td2.sq, mapping = aes(x = duration, y = yaw.td2.sq)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle(&quot;Yaw&quot;) +
  xlab(&quot;Duration&quot;) + 
  ylab(&quot;Degrees&quot;)

# plot motion.td2.sq into one figure
grid.arrange(motion_x.td2.sq, motion_y.td2.sq, motion_z.td2.sq, motion_roll.td2.sq, motion_pitch.td2.sq, motion_yaw.td2.sq, nrow = 2, ncol = 3, top = &quot;Second Temporal Derivatives of the 6-Rigid Body Motion Parameters Squared&quot;)</code></pre>
<p><img src="blog_Calculate_Motion_Regressors_files/figure-html/m36-1.png" width="672" /></p>
<p><BR><BR></p>
</div>
<div id="r-script" class="section level2">
<h2>R Script</h2>
<pre class="r"><code># ===============================================================
# 6-motion parameters

# load 6-rigid body motion parameters file and assign to ds.motion
ds.motion &lt;- read.csv(file.choose()) 

# rename columns
colnames(ds.motion) &lt;- c(&quot;x&quot;,&quot;y&quot;,&quot;z&quot;,&quot;roll&quot;,&quot;pitch&quot;,&quot;yaw&quot;) 

# ===============================================================
# 12-motion parameters

# square 6-rigid body motion parameters
ds.motion.sq &lt;- ds.motion^2 

# rename columns
colnames(ds.motion.sq) &lt;- c(&quot;x.sq&quot;,&quot;y.sq&quot;,&quot;z.sq&quot;,&quot;roll.sq&quot;,&quot;pitch.sq&quot;,&quot;yaw.sq&quot;)

# combine the 12-motion parameters into one dataset
ds.motion.12mp &lt;- data.frame(ds.motion,ds.motion.sq) 

# save 12-motion parameters as a csv file
write.csv(ds.motion.12mp, &quot;ds.motoin.12mp.csv&quot;)

# ===============================================================
# 24-motion parameters

# subtract motion from prior motion time point
ds.motion.td1 &lt;- sapply(ds.motion, FUN=function(x) c(NA,diff(x))) 

# rename columns
colnames(ds.motion.td1) &lt;- c(&quot;x.td1&quot;,&quot;y.td1&quot;,&quot;z.td1&quot;,&quot;roll.td1&quot;,&quot;pitch.td1&quot;,&quot;yaw.td1&quot;)  

# square td1
ds.motion.td1.sq &lt;- ds.motion.td1^2 

# rename columns
colnames(ds.motion.td1.sq ) &lt;- c(&quot;x.td1.sq &quot;,&quot;y.td1.sq &quot;,&quot;z.td1.sq &quot;,&quot;roll.td1.sq &quot;,&quot;pitch.td1.sq &quot;,&quot;yaw.td1.sq &quot;) 

# combine the 24-motion parameters into one dataset
ds.motion.24mp &lt;- data.frame(ds.motion.12mp,ds.motion.td1,ds.motion.td1.sq) 

# save 24-motion parameters as a csv file
write.csv(ds.motion.24mp, &quot;ds.motoin.24mp.csv&quot;)

# ===============================================================
# 36-motion parameters

# subtract motion from the motion of two prior time points
ds.motion.td2 &lt;- sapply(dataset, FUN=function(x) c(NA,NA,diff(x, lag=2))) 

# rename columns
colnames(ds.motion.td2) &lt;- c(&quot;x.td2&quot;,&quot;y.td2&quot;,&quot;z.td2&quot;,&quot;roll.td2&quot;,&quot;pitch.td2&quot;,&quot;yaw.td2&quot;) 

# square td2
ds.motion.td2.sq &lt;- ds.motion.td2^2 

# rename columns 
colnames(ds.motion.td2.sq ) &lt;- c(&quot;x.td2.sq &quot;,&quot;y.td2.sq &quot;,&quot;z.td2.sq &quot;,&quot;roll.td2.sq &quot;,&quot;pitch.td2.sq &quot;,&quot;yaw.td2.sq &quot;) 

# combine the 36-motion parameters into one dataset
ds.motion.36mp &lt;- data.frame(ds.motion.24mp,ds.motion.td2,ds.motion.td2.sq) 

# save 36-motion parameters as a csv file
write.csv(ds.motion.36mp, &quot;ds.motoin.36mp.csv&quot;)</code></pre>
<p><BR><BR></p>
</div>
<div id="references" class="section level2">
<h2>References</h2>
<div class="divReferences">
<p>Friston, K. J., Williams, S., Howard, R., Frackowiak, R. S. J., &amp; Turner, R. (1996). Movement-related effects in fMRI time-series. <em>Magnetic Resonance in Medicine, 35</em>(3), 346–355. <a href="http://doi.org/10.1002/mrm.1910350312" class="uri">http://doi.org/10.1002/mrm.1910350312</a></p>
<p>Yan, C.-G., Cheung, B., Kelly, C., Colcombe, S., Craddock, R. C., Di Martino, A., … Milham, M. P. (2013). A comprehensive assessment of regional variation in the impact of head micromovements on functional connectomics. <em>NeuroImage, 76</em>, 183–201. <a href="http://doi.org/10.1016/j.neuroimage.2013.03.004" class="uri">http://doi.org/10.1016/j.neuroimage.2013.03.004</a></p>
</div>
</div>

</div>
</div>
</div>
<div class="footer">
  <hr style="solid 1px">
  &copy; 2018 Ekarin Eric Pongpipat. <a href="https://raw.githubusercontent.com/epongpipat/epongpipat.github.io/master/LICENSE" target="_blank">All rights reserved.</a>
</div>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
