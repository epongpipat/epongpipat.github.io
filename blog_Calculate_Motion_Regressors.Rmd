---
title: "Calculate Motion Regressors"
subtitle: "A quick guide to calculating motion regressors (with visuals)"
date: "2018-03-20"
output: 
  html_document:
    highlight: textmate
    theme: lumen
    code_folding: hide
    toc: yes
    toc_depth: 3
    toc_float:
      collapsed: yes
      smooth_scroll: yes
---

```{r setup, include=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse); library(gridExtra)
```

*Tags:* <span class="badge badge-pill badge-dark">fMRI</span>
<span class="badge badge-pill badge-primary">R</span>

<BR>

These motion covariates can be used as potential control variables for resting-state and task-based functional connectivity. 

<BR><BR>

## 6-Rigid Body Motion Regressors

The first six motion parameters are the standard outputted motion parameters and include:

1. $X$, translation in the x-direction
2. $Y$, translation in the y-direction
3. $Z$, translation in the z-direction
4. $Roll$, rotation around the x-axis
5. $Pitch$, rotation around the y-axis
6. $Yaw$, rotation around the z-axis

```{r m6}

# load 6-rigidy body motion parameters
motion_demeaned <- read.csv("blog_Calculate_Motion_Regressors_files/example_motion_demeand.csv",header = FALSE)

# motion_demeaned <- t(apply(motion_demeaned, 1, sample, replace=TRUE))
# 
# motion_demeaned <- as.data.frame(motion_demeaned)

# rename columns
colnames(motion_demeaned) <- c("x","y","z","roll","pitch","yaw")

# add duration for graphs
motion_demeaned$duration <- c(1:780)

# plot x
motion_x <- ggplot(motion_demeaned, mapping = aes(x = duration, y = x)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle("X") +
  xlab("Duration") + 
  ylab("mm")

# plot y
motion_y <- ggplot(motion_demeaned, mapping = aes(x = duration, y = y)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle("Y") +
  xlab("Duration") + 
  ylab("mm")

# plot z
motion_z <- ggplot(motion_demeaned, mapping = aes(x = duration, y = z)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle("Z") +
  xlab("Duration") + 
  ylab("mm")

# plot roll
motion_roll <- ggplot(motion_demeaned, mapping = aes(x = duration, y = roll)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle("Roll") +
  xlab("Duration") + 
  ylab("Degrees")

# plot pitch
motion_pitch <- ggplot(motion_demeaned, mapping = aes(x = duration, y = pitch)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle("Pitch") +
  xlab("Duration") + 
  ylab("Degrees")

# plot yaw
motion_yaw <- ggplot(motion_demeaned, mapping = aes(x = duration, y = yaw)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle("Yaw") +
  xlab("Duration") + 
  ylab("Degrees")

# plot 6-rigid body motion parameters into one figure
grid.arrange(motion_x, motion_y, motion_z, motion_roll, motion_pitch, motion_yaw, nrow = 2, ncol = 3, top = "6-Rigid Body Motion Parameters")

```

<BR><BR>

## 12-Motion Regressors

The next six motion parameters are the original six rigid body motion parameters squared:

7. $X^2$, translation in the x-direction squared
8. $Y^2$, translation in the y-direction squared
9. $Z^2$, translation in the z-direction squared
10. $Roll^2$, rotation around the x-axis squared
11. $Pitch^2$, rotation around the y-axis squared
12. $Yaw^2$, rotation around the z-axis squared

```{r m12}

# square 6-rigid body motion parameters
motion_demeaned.sq <- motion_demeaned^2 

# save as data frame
motion_demeaned.sq <- as.data.frame(motion_demeaned.sq)

# rename columns
colnames(motion_demeaned.sq) <- c("x.sq","y.sq","z.sq","roll.sq","pitch.sq","yaw.sq","duration")

# add duration for graphs
motion_demeaned.sq$duration <- c(1:780)

# plot x.sq
motion_x.sq <- ggplot(motion_demeaned.sq, mapping = aes(x = duration, y = x.sq)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle("X") +
  xlab("Duration") + 
  ylab("mm")

# plot y.sq
motion_y.sq <- ggplot(motion_demeaned.sq, mapping = aes(x = duration, y = y.sq)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle("Y") +
  xlab("Duration") + 
  ylab("mm")

# plot z.sq
motion_z.sq <- ggplot(motion_demeaned.sq, mapping = aes(x = duration, y = z.sq)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle("Z") +
  xlab("Duration") + 
  ylab("mm")

# plot roll.sq
motion_roll.sq <- ggplot(motion_demeaned.sq, mapping = aes(x = duration, y = roll.sq)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle("Roll") +
  xlab("Duration") + 
  ylab("Degrees")

# plot pitch.sq
motion_pitch.sq <- ggplot(motion_demeaned.sq, mapping = aes(x = duration, y = pitch.sq)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle("Pitch") +
  xlab("Duration") + 
  ylab("Degrees")

# plot yaw.sq
motion_yaw.sq <- ggplot(motion_demeaned.sq, mapping = aes(x = duration, y = yaw.sq)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle("Yaw") +
  xlab("Duration") + 
  ylab("Degrees")

# plot motion.sq into one figure
grid.arrange(motion_x.sq, motion_y.sq, motion_z.sq, motion_roll.sq, motion_pitch.sq, motion_yaw.sq, nrow = 2, ncol = 3, top = "6-Rigid Body Motion Parameters Squared")

```

<BR><BR>

## 18-Motion Regressors

The next six motion parameters are the first temporal derivates of the original six rigid body motion parameters. Specifically, it is the motion minus the motion from the previous time point.

13. $X_{TD}$, first temporal derivative of the translation in the x-direction
14. $Y_{TD}$, first temporal derivative of the translation in the y-direction
15. $Z_{TD}$, first temporal derivative of the translation in the z-direction
16. $Roll_{TD}$ first temporal derivative of rotation around the x-axis
17. $Pitch_{TD}$, first temporal derivative of rotation around the y-axis
18. $Yaw_{TD}$, first temporal derivative of rotation around the z-axis

```{r m18, warning=FALSE}

# calculate first temporal derivative
motion_demeaned.td1 <- sapply(motion_demeaned, FUN=function(x) c(NA,diff(x))) 

# save as dataframe
motion_demeaned.td1 <- as.data.frame(motion_demeaned.td1)

# rename columns
colnames(motion_demeaned.td1) <- c("x.td1","y.td1","z.td1","roll.td1","pitch.td1","yaw.td1","duration") 

# add duration for graphs
motion_demeaned.td1$duration <- c(1:780)

# plot x.td1
motion_x.td1 <- ggplot(motion_demeaned.td1, mapping = aes(x = duration, y = x.td1)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle("X") +
  xlab("Duration") + 
  ylab("mm")

# plot y.td1
motion_y.td1 <- ggplot(motion_demeaned.td1, mapping = aes(x = duration, y = y.td1)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle("Y") +
  xlab("Duration") + 
  ylab("mm")

# plot z.td1
motion_z.td1 <- ggplot(motion_demeaned.td1, mapping = aes(x = duration, y = z.td1)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle("Z") +
  xlab("Duration") + 
  ylab("mm")

# plot roll.td1
motion_roll.td1 <- ggplot(motion_demeaned.td1, mapping = aes(x = duration, y = roll.td1)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle("Roll") +
  xlab("Duration") + 
  ylab("Degrees")

# plot pitch.td1
motion_pitch.td1 <- ggplot(motion_demeaned.td1, mapping = aes(x = duration, y = pitch.td1)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle("Pitch") +
  xlab("Duration") + 
  ylab("Degrees")

# plot yaw.td1
motion_yaw.td1 <- ggplot(motion_demeaned.td1, mapping = aes(x = duration, y = yaw.td1)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle("Yaw") +
  xlab("Duration") + 
  ylab("Degrees")

# plot motion.td1 into one figure
grid.arrange(motion_x.td1, motion_y.td1, motion_z.td1, motion_roll.td1, motion_pitch.td1, motion_yaw.td1, nrow = 2, ncol = 3, top = "First Temporal Derivatives of the 6-Rigid Body Motion Parameters")

```

<BR><BR>

## 24-Motion Regressors

The next six motion parameters are the first temporal derivatives squared.

19. $X_{TD}^2$, first temporal derivative of the translation in the x-direction squared
20. $Y_{TD}^2$, first temporal derivative of the translation in the y-direction squared
21. $Z_{TD}^2$, first temporal derivative of the translation in the z-direction squared
22. $Roll_{TD}^2$, first temporal derivative of rotation around the x-axis squared
23. $Pitch_{TD}^2$ first temporal derivative of rotation around the y-axis squared
24. $Yaw_{TD}^2$, first temporal derivative of rotation around the z-axis squared

```{r m24, warning = FALSE}

# square the first temporal derivative
motion_demeaned.td1.sq <- motion_demeaned.td1^2 # first temporal derivative squared

# save as dataframe
motion_demeaned.td1.sq <- as.data.frame(motion_demeaned.td1.sq)

# rename columns
colnames(motion_demeaned.td1.sq) <- c("x.td1.sq","y.td1.sq","z.td1.sq","roll.td1.sq","pitch.td1.sq","yaw.td1.sq","duration") # rename columns

# add duration for graphs
motion_demeaned.td1.sq$duration <- c(1:780)

# plot x.td1.sq
motion_x.td1.sq <- ggplot(motion_demeaned.td1.sq, mapping = aes(x = duration, y = x.td1.sq)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle("X") +
  xlab("Duration") + 
  ylab("mm")

# plot y.td1.sq
motion_y.td1.sq <- ggplot(motion_demeaned.td1.sq, mapping = aes(x = duration, y = y.td1.sq)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle("Y") +
  xlab("Duration") + 
  ylab("mm")

# plot z.td1.sq
motion_z.td1.sq <- ggplot(motion_demeaned.td1.sq, mapping = aes(x = duration, y = z.td1.sq)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle("Z") +
  xlab("Duration") + 
  ylab("mm")

# plot roll.td1.sq
motion_roll.td1.sq <- ggplot(motion_demeaned.td1.sq, mapping = aes(x = duration, y = roll.td1.sq)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle("Roll") +
  xlab("Duration") + 
  ylab("Degrees")

# plot pitch.td1.sq
motion_pitch.td1.sq <- ggplot(motion_demeaned.td1.sq, mapping = aes(x = duration, y = pitch.td1.sq)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle("Pitch") +
  xlab("Duration") + 
  ylab("Degrees")

# plot yaw.td1.sq
motion_yaw.td1.sq <- ggplot(motion_demeaned.td1.sq, mapping = aes(x = duration, y = yaw.td1.sq)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle("Yaw") +
  xlab("Duration") + 
  ylab("Degrees")

# plot motion.td1.sq into one figure
grid.arrange(motion_x.td1.sq, motion_y.td1.sq, motion_z.td1.sq, motion_roll.td1.sq, motion_pitch.td1.sq, motion_yaw.td1.sq, nrow = 2, ncol = 3, top = "First Temporal Derivatives of the 6-Rigid Body Motion Parameters Squared")

```

<BR><BR>

## 30-Motion Regressors

The next six motion parameters are the second temporal derivatives of the original six rigid body motion parameters. Specifically, it is the motion minus the motion from the two previous time points.

25. $X_{TD2}$, second temporal derivative of the translation in the x-direction 
26. $Y_{TD2}$, second temporal derivative of the translation in the y-direction 
27. $Z_{TD2}$, second temporal derivative of the translation in the z-direction 
28. $Roll_{TD2}$, second temporal derivative of rotation around the x-axis 
29. $Pitch_{TD2}$, second temporal derivative of rotation around the y-axis 
30. $Yaw_{TD2}$, second temporal derivative of rotation around the z-axis

```{r m30, warning=FALSE}

# calculate second temporal derivative
motion_demeaned.td2 <- sapply(motion_demeaned, FUN=function(x) c(NA,NA,diff(x, lag = 2))) 

# save as dataframe
motion_demeaned.td2 <- as.data.frame(motion_demeaned.td2)

# rename columns
colnames(motion_demeaned.td2) <- c("x.td2","y.td2","z.td2","roll.td2","pitch.td2","yaw.td2","duration") 

# add duration for graphs
motion_demeaned.td2$duration <- c(1:780)

# plot x.td2
motion_x.td2 <- ggplot(motion_demeaned.td2, mapping = aes(x = duration, y = x.td2)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle("X") +
  xlab("Duration") + 
  ylab("mm")

# plot y.td2
motion_y.td2 <- ggplot(motion_demeaned.td2, mapping = aes(x = duration, y = y.td2)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle("Y") +
  xlab("Duration") + 
  ylab("mm")

# plot z.td2
motion_z.td2 <- ggplot(motion_demeaned.td2, mapping = aes(x = duration, y = z.td2)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle("Z") +
  xlab("Duration") + 
  ylab("mm")

# plot roll.td2
motion_roll.td2 <- ggplot(motion_demeaned.td2, mapping = aes(x = duration, y = roll.td2)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle("Roll") +
  xlab("Duration") + 
  ylab("Degrees")

# plot pitch.td2
motion_pitch.td2 <- ggplot(motion_demeaned.td2, mapping = aes(x = duration, y = pitch.td2)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle("Pitch") +
  xlab("Duration") + 
  ylab("Degrees")

# plot yaw.td2
motion_yaw.td2 <- ggplot(motion_demeaned.td2, mapping = aes(x = duration, y = yaw.td2)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle("Yaw") +
  xlab("Duration") + 
  ylab("Degrees")

# plot motion.td2 into one figure
grid.arrange(motion_x.td2, motion_y.td2, motion_z.td2, motion_roll.td2, motion_pitch.td2, motion_yaw.td2, nrow = 2, ncol = 3, top = "Second Temporal Derivatives of the 6-Rigid Body Motion Parameters")

```

<BR><BR>

## 36-Motion Regressors

The next six motion parameters are the second temporal derivatives squared.

31. $X_{TD2}^2$, second temporal derivative of the translation in the x-direction squared
32. $Y_{TD2}^2$, second temporal derivative of the translation in the y-direction squared
33. $Z_{TD2}^2$, second temporal derivative of the translation in the z-direction squared
34. $Roll_{TD2}^2$, second temporal derivative of rotation around the x-axis squared
35. $Pitch_{TD2}^2$, second temporal derivative of rotation around the y-axis squared
36. $Yaw_{TD2}^2$, second temporal derivative of rotation around the z-axis squared

```{r m36, warning = FALSE}

# second temporal derivative squared
motion_demeaned.td2.sq <- motion_demeaned.td2^2 

# save as dataframe
motion_demeaned.td2.sq <- as.data.frame(motion_demeaned.td2.sq)

# rename columns
colnames(motion_demeaned.td2.sq) <- c("x.td2.sq","y.td2.sq","z.td2.sq","roll.td2.sq","pitch.td2.sq","yaw.td2.sq","duration") 

# add duration for graphs
motion_demeaned.td2.sq$duration <- c(1:780)

# plot x.td2.sq
motion_x.td2.sq <- ggplot(motion_demeaned.td2.sq, mapping = aes(x = duration, y = x.td2.sq)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle("X") +
  xlab("Duration") + 
  ylab("mm")

# plot y.td2.sq
motion_y.td2.sq <- ggplot(motion_demeaned.td2.sq, mapping = aes(x = duration, y = y.td2.sq)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle("Y") +
  xlab("Duration") + 
  ylab("mm")

# plot z.td2.sq
motion_z.td2.sq <- ggplot(motion_demeaned.td2.sq, mapping = aes(x = duration, y = z.td2.sq)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle("Z") +
  xlab("Duration") + 
  ylab("mm")

# plot roll.td2.sq
motion_roll.td2.sq <- ggplot(motion_demeaned.td2.sq, mapping = aes(x = duration, y = roll.td2.sq)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle("Roll") +
  xlab("Duration") + 
  ylab("Degrees")

# plot pitch.td2.sq
motion_pitch.td2.sq <- ggplot(motion_demeaned.td2.sq, mapping = aes(x = duration, y = pitch.td2.sq)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle("Pitch") +
  xlab("Duration") + 
  ylab("Degrees")

# plot yaw.td2.sq
motion_yaw.td2.sq <- ggplot(motion_demeaned.td2.sq, mapping = aes(x = duration, y = yaw.td2.sq)) + 
  geom_line() +
  theme_classic() + 
  theme(plot.title = element_text(hjust = .5), 
        plot.subtitle = element_text(hjust = .5)
        ) +
  ggtitle("Yaw") +
  xlab("Duration") + 
  ylab("Degrees")

# plot motion.td2.sq into one figure
grid.arrange(motion_x.td2.sq, motion_y.td2.sq, motion_z.td2.sq, motion_roll.td2.sq, motion_pitch.td2.sq, motion_yaw.td2.sq, nrow = 2, ncol = 3, top = "Second Temporal Derivatives of the 6-Rigid Body Motion Parameters Squared")

```

<BR><BR>

## R Script
```{r script, eval=FALSE, collapse=FALSE, include=TRUE, echo=TRUE}

# ===============================================================
# 6-motion parameters

# load 6-rigid body motion parameters file and assign to ds.motion
ds.motion <- read.csv(file.choose()) 

# rename columns
colnames(ds.motion) <- c("x","y","z","roll","pitch","yaw") 

# ===============================================================
# 12-motion parameters

# square 6-rigid body motion parameters
ds.motion.sq <- ds.motion^2 

# rename columns
colnames(ds.motion.sq) <- c("x.sq","y.sq","z.sq","roll.sq","pitch.sq","yaw.sq")

# combine the 12-motion parameters into one dataset
ds.motion.12mp <- data.frame(ds.motion,ds.motion.sq) 

# save 12-motion parameters as a csv file
write.csv(ds.motion.12mp, "ds.motoin.12mp.csv")

# ===============================================================
# 24-motion parameters

# subtract motion from prior motion time point
ds.motion.td1 <- sapply(ds.motion, FUN=function(x) c(NA,diff(x))) 

# rename columns
colnames(ds.motion.td1) <- c("x.td1","y.td1","z.td1","roll.td1","pitch.td1","yaw.td1")  

# square td1
ds.motion.td1.sq <- ds.motion.td1^2 

# rename columns
colnames(ds.motion.td1.sq ) <- c("x.td1.sq ","y.td1.sq ","z.td1.sq ","roll.td1.sq ","pitch.td1.sq ","yaw.td1.sq ") 

# combine the 24-motion parameters into one dataset
ds.motion.24mp <- data.frame(ds.motion.12mp,ds.motion.td1,ds.motion.td1.sq) 

# save 24-motion parameters as a csv file
write.csv(ds.motion.24mp, "ds.motoin.24mp.csv")

# ===============================================================
# 36-motion parameters

# subtract motion from the motion of two prior time points
ds.motion.td2 <- sapply(dataset, FUN=function(x) c(NA,NA,diff(x, lag=2))) 

# rename columns
colnames(ds.motion.td2) <- c("x.td2","y.td2","z.td2","roll.td2","pitch.td2","yaw.td2") 

# square td2
ds.motion.td2.sq <- ds.motion.td2^2 

# rename columns 
colnames(ds.motion.td2.sq ) <- c("x.td2.sq ","y.td2.sq ","z.td2.sq ","roll.td2.sq ","pitch.td2.sq ","yaw.td2.sq ") 

# combine the 36-motion parameters into one dataset
ds.motion.36mp <- data.frame(ds.motion.24mp,ds.motion.td2,ds.motion.td2.sq) 

# save 36-motion parameters as a csv file
write.csv(ds.motion.36mp, "ds.motoin.36mp.csv")

```

<BR><BR>

## References

<div class="divReferences">
Friston, K. J., Williams, S., Howard, R., Frackowiak, R. S. J., & Turner, R. (1996). Movement-related effects in fMRI time-series. *Magnetic Resonance in Medicine, 35*(3), 346–355. http://doi.org/10.1002/mrm.1910350312

Yan, C.-G., Cheung, B., Kelly, C., Colcombe, S., Craddock, R. C., Di Martino, A., … Milham, M. P. (2013). A comprehensive assessment of regional variation in the impact of head micromovements on functional connectomics. *NeuroImage, 76*, 183–201. http://doi.org/10.1016/j.neuroimage.2013.03.004
</div>