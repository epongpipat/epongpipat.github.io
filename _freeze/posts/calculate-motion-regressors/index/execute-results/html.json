{
  "hash": "4e807ad328e6275cf4ea2ebd41d1cead",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Calculate 24-Motion Variables\"\nsubtitle: \"A quick guide to calculating 24-motion variables\"\ndate: \"2018-03-20\"\ndate-modified: \"2019-03-24\"\nformat:\n  html:\n    toc: true\n    toc-title: \"Table of Contents\"\n    toc-depth: 3\n    toc-location: left\n    number-sections: true\n    code-fold: show\n    warning: false\ncategories: [fMRI, motion, R, preprocessing]\n\n---\n\n\n\nThis is a quick guide to calculate the 24 motion parameters from the original six motion parameters. These 24 motion parameters can be used as control variables (covariates of no interest; nuisance regressors) that is typically performed in fMRI first-level analyses, especially in resting-state and task-based functional connectivity analyses. \n\n<BR><BR>\n\n## R Libraries\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# data loading, manipulation, and writing\nlibrary(tidyverse)\n```\n:::\n\n\n\n<BR><BR>\n\n## Function\n\nA helper function to plot the motion parameters.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# graph motion parameters and facet by motion type\ngraph_motion <- function(dataset, title) {\n  require(reshape2)\n  data_long <- melt(dataset, id.var = \"Duration\") %>%\n    mutate(variable = gsub(\"_\", \" \", variable))\n  figure <- ggplot(data_long, aes(x = Duration, y = value)) +\n    geom_line(color = '#737373') +\n    theme_minimal() +\n    facet_wrap(~ variable, scales = \"free_y\", ncol = 3) +\n    labs(title = title,\n         y = NULL) +\n    theme(plot.title = element_text(hjust = 0.5))\n  print(figure)\n}\n```\n:::\n\n\n\n<BR><BR>\n\n## Calculate 24-Motion Parameters\n\n### 6-Rigid Body Motion Regressors\n\nThe first six motion parameters are the standard motion parameters and include:\n\n1. $t_x$, translation in the x-direction\n2. $t_y$, translation in the y-direction\n3. $t_z$, translation in the z-direction\n4. $\\theta_x$, rotation around the x-axis\n5. $\\theta_y$, rotation around the y-axis\n6. $\\theta_z$, rotation around the z-axis\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# load 6-rigid body motion parameters\n# add duration\nmotion_file <- \"data/data_demeaned.csv\"\nmotion_demeaned <- read_csv(motion_file, col_names = F) %>%\n  mutate(Duration = c(1:nrow(.)))\n\n# rename columns\nmotion_variables <- c(paste0(\"Translation_\", c(\"X\", \"Y\", \"Z\")),\n                      paste0(\"Rotation_\", c(\"X\", \"Y\", \"Z\")))\ncolnames(motion_demeaned) <- c(motion_variables, \"Duration\")\n\n# graph motion parameters\ngraph_motion(motion_demeaned, \"6-Rigid Body Motion Parameters\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/m6-1.png){width=672}\n:::\n:::\n\n\n\n<BR><BR>\n\n### 12-Motion Regressors\n\nThe next six motion parameters are the first temporal derivatives of the original six rigid body motion parameters. Specifically, it is the motion minus the motion from the previous time point.\n\n7. $t_{x_{TD1}}$, first temporal derivative of the translation in the x-direction\n8. $t_{y_{TD1}}$, first temporal derivative of the translation in the y-direction\n9. $t_{z_{TD1}}$, first temporal derivative of the translation in the z-direction\n10. $\\theta_{x_{TD1}}$ first temporal derivative of the rotation around the x-axis\n11. $\\theta_{y_{TD1}}$, first temporal derivative of the rotation around the y-axis\n12. $\\theta_{z_{TD1}}$, first temporal derivative of the rotation around the z-axis\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# calculate first temporal derivative\nmotion_demeaned_td1 <- motion_demeaned %>%\n  sapply(., FUN = function(x) c(NA, diff(x))) %>%\n  as_tibble() %>%\n  mutate(Duration = c(1:nrow(.)))\n  \n# rename columns\ncolnames(motion_demeaned_td1) <- c(paste0(motion_variables, \"_TD1\"), \"Duration\")\n\n# graph motion parameters\ngraph_motion(motion_demeaned_td1, \"First Temporal Derivatives of the 6-Rigid Body Motion Parameters\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/m12-1.png){width=672}\n:::\n:::\n\n\n\n<BR><BR>\n\n### 18-Motion Regressors\n\nThe next six motion parameters are the original six rigid body motion parameters squared:\n\n13. $t_x^2$, translation in the x-direction squared\n14. $t_y^2$, translation in the y-direction squared\n15. $t_z^2$, translation in the z-direction squared\n16. $\\theta_x^2$, rotation around the x-axis squared\n17. $\\theta_y^2$, rotation around the y-axis squared\n18. $\\theta_z^2$, rotation around the z-axis squared\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# square 6-rigid body motion parameters\nmotion_demeaned_sq <- motion_demeaned^2 %>%\n  as_tibble() %>%\n  mutate(Duration = c(1:nrow(.)))\n  \n# rename columns\ncolnames(motion_demeaned_sq) <- c(paste0(motion_variables, \"_Squared\"), \"Duration\")\n\n# graph motion parameters\ngraph_motion(motion_demeaned_sq, \"6-Rigid Body Motion Parameters Squared\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/m18-1.png){width=672}\n:::\n:::\n\n\n\n<BR><BR>\n\n### 24-Motion Regressors\n\nThe next six motion parameters are the first temporal derivatives squared.\n\n19. $t_{x_{TD1}}^2$, first temporal derivative of the translation in the x-direction squared\n20. $t_{y_{TD1}}^2$, first temporal derivative of the translation in the y-direction squared\n21. $t_{z_{TD1}}^2$, first temporal derivative of the translation in the z-direction squared\n22. $\\theta_{x_{TD1}}^2$, first temporal derivative of the rotation around the x-axis squared\n23. $\\theta_{y_{TD1}}^2$ first temporal derivative of the rotation around the y-axis squared\n24. $\\theta_{z_{TD1}}^2$, first temporal derivative of the rotation around the z-axis squared\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# square the first temporal derivative\nmotion_demeaned_td1_sq <- motion_demeaned_td1^2 %>%\n  as_tibble() %>%\n  mutate(Duration = 1:nrow(.)) \n\n# rename columns\ncolnames(motion_demeaned_td1_sq) <- c(paste0(motion_variables, \"_TD1_Squared\"), \"Duration\")\n\n# plot motion.td1.sq into one figure\ngraph_motion(motion_demeaned_td1_sq, \"First Temporal Derivatives of the 6-Rigid Body Motion Parameters Squared\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/m24-1.png){width=672}\n:::\n:::\n\n\n\n<BR><BR>\n\n## Full R Code Example\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# function to create 24 motion variables =======================================\ncreate_24_motion_variables <- function(dataset) {\n  # mean-center (demean) ----\n  # subtract each score from its respective column mean\n  dataset_motion_demeaned <- scale(x = dataset, center = T, scale = F)\n\n  # first temporal derivatives ----\n  # subtract motion from prior motion time point\n  dataset_motion_td1 <- sapply(dataset_motion_demeaned, FUN = function(x) c(NA, diff(x)))\n\n  # combine the variables into one dataset\n  dataset_motion <- data.frame(dataset_motion_demeaned, dataset_motion_td1)\n\n  # squares ----\n  # square 6-rigid body motion parameters and its temporal derivatives\n  dataset_motion_squared <- dataset_motion^2\n\n  # combine the variables into one dataset\n  dataset_motion <- data.frame(dataset_motion, dataset_motion_squared)\n\n  return(dataset_motion)\n}\n\n# load 6-rigid body motion parameters file =====================================\n# assign to dataset_motion\ndataset_motion <- read_csv(file.choose())\n\n# create 24 motion variables using function ====================================\n# assign output to dataset_motion_24\ndataset_motion_24 <- create_24_motion_variables(dataset = dataset_motion)\n\n# rename columns ===============================================================\n# assign original motion variables\nmotion_variables <- c(\n  \"trans_x\", \"trans_y\", \"trans_z\",\n  \"rot_x\", \"rot_y\", \"rot_z\"\n)\n\n# rename columns\ncolnames(dataset_motion_24) <- c(\n  motion_variables,\n  paste0(motion_variables, \"_td1\"),\n  paste0(motion_variables, \"_sq\"),\n  paste0(motion_variables, \"_td1_sq\")\n)\n\n# export 24-motion variables ===================================================\nwrite_csv(x = dataset_motion_24, file = \"dataset-motion-24.csv\")\n```\n:::\n\n\n\n<BR><BR>\n\n**Note**: Similar logic can also be applied to cerebral spinal fluid (CSF) and white matter (WM) time series to obtain an additional 8 nuisance regressors (32 nuisance regressors in total).\n\n## References\n\n<div class=\"divReferences\">\nFriston, K. J., Williams, S., Howard, R., Frackowiak, R. S. J., & Turner, R. (1996). Movement-related effects in fMRI time-series. *Magnetic Resonance in Medicine, 35*(3), 346–355. http://doi.org/10.1002/mrm.1910350312\n\nYan, C.-G., Cheung, B., Kelly, C., Colcombe, S., Craddock, R. C., Di Martino, A., … Milham, M. P. (2013). A comprehensive assessment of regional variation in the impact of head micromovements on functional connectomics. *NeuroImage, 76*, 183–201. http://doi.org/10.1016/j.neuroimage.2013.03.004\n</div>\n\n<!-- disqus START -->\n<br>\n\n<hr>\n\n<br>\n\n<div id=\"disqus_thread\"></div>\n<script>\n/**\n*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.\n*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/\n/*\nvar disqus_config = function () {\nthis.page.url = 'https://ekarinpongpipat.com/blog_Calculate_Motion_Regressors.html';  // Replace PAGE_URL with your page's canonical URL variable\nthis.page.identifier = 'blog_Calculate_Motion_Regressors'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable\n};\n*/\n(function() { // DON'T EDIT BELOW THIS LINE\nvar d = document, s = d.createElement('script');\ns.src = 'https://epongpipat.disqus.com/embed.js';\ns.setAttribute('data-timestamp', +new Date());\n(d.head || d.body).appendChild(s);\n})();\n</script>\n<noscript>Please enable JavaScript to view the <a href=\"https://disqus.com/?ref_noscript\">comments powered by Disqus.</a></noscript>\n<!-- disqus END -->",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}